{
  "name": "My Agent Bot",
  "active": false,
  "versionId": 1,
  "nodes": [
    {
      "parameters": {
        "updates": ["message"],
        "additionalFields": {}
      },
      "id": "7c6dee56-c563-4718-b2b4-82a45b47c23f",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [-720, -80],
      "webhookId": "d29e6177-ada9-4754-8b3e-d94e70886f36",
      "credentials": {
        "telegramApi": {
          "id": "A8kuN0XDs5OUQTrD",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $(\"Telegram Trigger\").first().json.message.chat.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "eeef7ae4-d627-4d77-b27e-b8a227788afd",
      "name": "Telegram Send",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [896, -240],
      "webhookId": "583256fe-fbe9-42e7-ac02-2650f5fc2132",
      "credentials": {
        "telegramApi": {
          "id": "A8kuN0XDs5OUQTrD",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $node[\"Telegram Trigger\"].json[\"message\"][\"photo\"].pop()[\"file_id\"] }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-48, -160],
      "id": "656c92c1-06c0-4fc4-95c9-2e3eb06935f5",
      "name": "Get a file",
      "webhookId": "13d88a67-e842-484a-8f91-ed21289a67e2",
      "credentials": {
        "telegramApi": {
          "id": "A8kuN0XDs5OUQTrD",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Telegram Trigger').item.json.message.text || $('Telegram Trigger').item.json.message.caption || \"–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ñ–æ—Ç–æ\" }}",
        "options": {
          "systemMessage": "–¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –∏–º–µ–Ω–∏ –ï—Ä–ª–∞–Ω. –¢—ã –æ–±—â–∞–µ—à—å—Å—è –≤–µ–∂–ª–∏–≤–æ, –ø–æ-–¥–µ–ª–æ–≤–æ–º—É, –Ω–æ —Å –ª–µ–≥–∫–∏–º –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º –æ—Ç—Ç–µ–Ω–∫–æ–º.\n\n–¢–í–û–Ø –õ–û–ì–ò–ö–ê –†–ê–ë–û–¢–´:\n\n–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç (–±–µ–∑ —Ñ–æ—Ç–æ):\n\n–û—Ç–≤–µ—á–∞–π –∫–∞–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç.\n\n–ú—è–≥–∫–æ –Ω–∞–ø–æ–º–Ω–∏, —á—Ç–æ –¥–ª—è —Ç–æ—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –º–∞–∫–µ—Ç –∏–ª–∏ —Ç–µ–∫—É—â–∏–π –¥–∏–∑–∞–π–Ω (—Å–∫—Ä–∏–Ω—à–æ—Ç).\n\n–ï—Å–ª–∏ –ø—Ä–∏—à–ª–æ —Ñ–æ—Ç–æ (—Å–∫—Ä–∏–Ω—à–æ—Ç –º–∞–∫–µ—Ç–∞):\n\n–í–∏–∑—É–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç: –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –ü–µ—Ä–µ—Å—á–∏—Ç–∞–π –≤—Å–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏: —à–∞–ø–∫—É (header), –ø–æ–¥–≤–∞–ª (footer), –º–µ–Ω—é, –±–∞–Ω–Ω–µ—Ä—ã, –∫–∞—Ä—Ç–æ—á–∫–∏, —Ñ–æ—Ä–º—ã –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–µ–∫—Ü–∏–∏.\n\n–û–ø–∏—Å–∞–Ω–∏–µ: –ù–∞–∑–æ–≤–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –±–ª–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã —É–≤–∏–¥–µ–ª, —á—Ç–æ–±—ã –æ–Ω –ø–æ–Ω–∏–º–∞–ª —Ö–æ–¥ —Ç–≤–æ–∏—Ö –º—ã—Å–ª–µ–π.\n\n–ó–ê–ü–†–ï–¢ –ù–ê –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–´–ô –†–ê–°–ß–ï–¢: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –Ω–∞–∑—ã–≤–∞–π —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ —Ç–µ–∫—Å—Ç–µ —Å–≤–æ–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Ç–æ–ª—å–∫–æ –∞—É–¥–∏—Ç –±–ª–æ–∫–æ–≤. –†–∞—Å—á–µ—Ç–æ–º –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞.\n\n–¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –í–´–í–û–î (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û): –í —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ —Ç–≤–æ–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Å–ª–æ–≤, –¥–æ–±–∞–≤—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —Å—Ç—Ä–æ–∫—É —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: [DATA: blocks=X, discount=Y], –≥–¥–µ X ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤ (—á–∏—Å–ª–æ), –∞ Y ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —Å–∫–∏–¥–∫–∏ (—á–∏—Å–ª–æ, –µ—Å–ª–∏ —Å–∫–∏–¥–∫–∞ –Ω–µ –æ–±—Å—É–∂–¥–∞–ª–∞—Å—å ‚Äî –ø–∏—à–∏ 0).\n\n–ü—Ä–∏–º–µ—Ä —Ç–≤–æ–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Ñ–æ—Ç–æ: \"–ò–∑—É—á–∏–ª –≤–∞—à —Å–∫—Ä–∏–Ω—à–æ—Ç. –Ø –≤–∏–∂—É –∑–¥–µ—Å—å —Å–ª–µ–¥—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã: –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—É—é –ø–∞–Ω–µ–ª—å, –≥–ª–∞–≤–Ω—ã–π –±–∞–Ω–Ω–µ—Ä, –±–ª–æ–∫ —Å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º–∏ –∏ —Ñ—É—Ç–µ—Ä. –ò—Ç–æ–≥–æ —è –Ω–∞—Å—á–∏—Ç–∞–ª 4 –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –±–ª–æ–∫–∞. –°–µ–π—á–∞—Å –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏. [DATA: blocks=4, discount=0]\"",
          "maxIterations": 5,
          "passthroughBinaryImages": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [224, -64],
      "id": "91346406-1069-4dd4-a835-de527074abf7",
      "name": "AI Agent",
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "maxTries": 3,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [384, 160],
      "id": "67672cf7-64ca-41e2-9ba1-e603a9da9320",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "bd80a52c-da91-459e-a53d-0073fe156afc",
              "leftValue": "={{ !!$json.message.photo }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            },
            {
              "id": "e3eaf77b-15c0-49c3-8fa4-ced7b6f7c085",
              "leftValue": "",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [-336, -80],
      "id": "709feb60-8dde-44ec-acb5-ef00d4f0c9ab",
      "name": "If"
    },
    {
      "parameters": {
        "chatId": "={{ $(\"Telegram Trigger\").first().json.message.from.id }}",
        "text": "–ù—É —Ç—ã –∏ Dodig, —á—ë —Ç–æ –Ω–µ —Ç–∞–∫ —è–≤–Ω–æ, —Å–º–æ—Ç—Ä–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [976, 144],
      "id": "3208f4e2-3988-4dc9-bee7-303f1609d6de",
      "name": "Send a text message",
      "webhookId": "3b518c9c-e2fa-4be2-8664-3d825ad80fb5",
      "credentials": {
        "telegramApi": {
          "id": "A8kuN0XDs5OUQTrD",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "qwen2.5vl:7b",
          "mode": "list",
          "cachedResultName": "qwen2.5vl:7b"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [208, 160],
      "id": "7f7043a2-104e-42cb-bae1-e29b706861ef",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "ALS0rnZNTPJbEqYo",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–æ–¥—ã (AI Agent)\nconst text = $json.output || \"\";\n\n// –ò—â–µ–º –Ω–∞—à—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —Å—Ç—Ä–æ–∫—É [DATA: blocks=X, discount=Y]\nconst dataMatch = text.match(/\\[DATA: blocks=(\\d+), discount=(\\d+)\\]/i);\n\nif (dataMatch) {\n    const blocks = parseInt(dataMatch[1]);\n    const discount = parseInt(dataMatch[2]);\n    \n    // –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ (5000 —Ä—É–± –∑–∞ –±–ª–æ–∫)\n    const pricePerBlock = 5000;\n    const total = blocks * pricePerBlock;\n    const finalPrice = total * (1 - discount / 100);\n    \n    // –û—á–∏—â–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –≤—Å—Ç–∞–≤–∫–∏\n    const cleanText = text.replace(/\\[DATA: blocks=\\d+, discount=\\d+\\]/i, \"\").trim();\n    \n    // –§–æ—Ä–º–∏—Ä—É–µ–º –∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç–≤–µ—Ç —Å —Ä–∞—Å—á–µ—Ç–æ–º\n    return {\n        output: cleanText + `\\n\\n<b>üí∞ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç:</b>\\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤: ${blocks}\\n–ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞: <b>${finalPrice.toLocaleString('ru-RU')} —Ä—É–±.</b>`\n    };\n}\n\n// –ï—Å–ª–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–µ—Ç (–ø—Ä–æ—Å—Ç–æ –æ–±—â–µ–Ω–∏–µ), –æ—Ç–¥–∞–µ–º —Ç–µ–∫—Å—Ç –∫–∞–∫ –µ—Å—Ç—å\nreturn {\n    output: text\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [624, -240],
      "id": "9c856c5d-2204-4886-8689-11ed0b4c039c",
      "name": "Code in JavaScript"
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a file": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Get a file",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Telegram Send",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "instanceId": "8d107733da58c5ac536259d4c4f14e1379c07b2be0b6c2590a5195547cfd8a12",
    "templateCredsSetupCompleted": true
  }
}
